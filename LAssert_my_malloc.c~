#define _GNU_SOURCE
#include <dlfcn.h>

#define NULL (void*)0

int _lassert_malloc_lock = 0;

void * malloc(size_t size){
    if(_lassert_malloc_lock){
        return NULL;
    }

    void * (*true_malloc)(size_t) = (void*(*)(size_t))dlsym(RTLD_NEXT, "malloc");

    if(!true_malloc){
        return NULL;
    }
    
    return true_malloc(size);
}
